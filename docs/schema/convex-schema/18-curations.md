# 18. curationsï¼ˆç®¡ç†è€…å³é¸ã®ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

**ğŸ“š ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: [CONVEX_SCHEMA_INDEX.md](../CONVEX_SCHEMA_INDEX.md)

### 18. curationsï¼ˆç®¡ç†è€…å³é¸ã®ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰âœ… **å¤–éƒ¨è¨˜äº‹ã®ç´¹ä»‹**

**ç›®çš„**: ç®¡ç†è€…ãŒå³é¸ã—ãŸå¤–éƒ¨è¨˜äº‹ã‚’ç´¹ä»‹ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¾¡å€¤ã‚ã‚‹æƒ…å ±ã‚’æä¾›ã™ã‚‹

**ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- `title`: è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
- `summary`: ç®¡ç†è€…ã«ã‚ˆã‚‹ç´¹ä»‹æ–‡ï¼ˆã€Œã“ã®è¨˜äº‹ã®ã“ã“ãŒãƒ¬ã‚ªãã‚“ã«å½¹ç«‹ã¤ã‹ã‚‚ï¼ã€ãªã©ã€ã‚¢ãƒ—ãƒªã®ç‹¬è‡ªä¾¡å€¤ï¼‰
- `sourceName`: æ²è¼‰å…ƒï¼ˆä¾‹: ã€Œãƒšãƒƒãƒˆå¥åº·ãƒ‰ãƒƒãƒˆã‚³ãƒ ã€ï¼‰
- `url`: å¤–éƒ¨URLï¼ˆã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ï¼‰
- `thumbnailUrl`: ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒURLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
- `thumbnailStorageId`: Convex Storageã®IDï¼ˆæ¨å¥¨ï¼šãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
- `category`: ã‚«ãƒ†ã‚´ãƒªï¼ˆhealth/food/lifestyle/care/emergencyï¼‰
- `targetSpecies`: å¯¾è±¡ãƒšãƒƒãƒˆç¨®åˆ¥ï¼ˆè¤‡æ•°é¸æŠå¯èƒ½ï¼‰
- `isPremium`: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡é™å®šã®å³é¸è¨˜äº‹ã‹ã©ã†ã‹
- `publishedAt`: å…¬é–‹æ—¥æ™‚
- `createdBy`: ä½œæˆè€…ï¼ˆç®¡ç†è€…ï¼‰

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `by_published`: å…¬é–‹æ—¥æ™‚ã§ã®æ¤œç´¢ï¼ˆæ–°ã—ã„é †ï¼‰
- `by_category`: ã‚«ãƒ†ã‚´ãƒªã§ã®æ¤œç´¢
- `by_premium`: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åˆ¶é™ã§ã®æ¤œç´¢
- `by_active`: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿å–å¾—

**æ©Ÿèƒ½åˆ¶é™**:
- **ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼**: è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã¨è¦ç´„ï¼ˆsummaryï¼‰ã¾ã§é–²è¦§å¯èƒ½
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å¤–éƒ¨è¨˜äº‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¨ã€ãã®è¨˜äº‹ã«åŸºã¥ã„ãŸã€ŒAIã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€ã®å—é ˜ãŒå¯èƒ½

**ä½¿ç”¨ä¾‹**:
```typescript
// ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆï¼ˆç®¡ç†è€…ï¼‰
const curationId = await ctx.db.insert("curations", {
  title: "é«˜é½¢çŠ¬ã®é£Ÿäº‹ç®¡ç†ã‚¬ã‚¤ãƒ‰",
  summary: "ã“ã®è¨˜äº‹ã§ã¯ã€14æ­³ä»¥ä¸Šã®é«˜é½¢çŠ¬ã«å¿…è¦ãªæ „é¤Šç´ ã¨é£Ÿäº‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¦ã„ã¾ã™ã€‚ãƒ¬ã‚ªãã‚“ã®ã‚ˆã†ãªé«˜é½¢çŠ¬ã®é£¼ã„ä¸»ã•ã‚“ã«ç‰¹ã«ãŠã™ã™ã‚ã§ã™ã€‚",
  sourceName: "ãƒšãƒƒãƒˆå¥åº·ãƒ‰ãƒƒãƒˆã‚³ãƒ ",
  url: "https://example.com/senior-dog-food-guide",
  thumbnailStorageId: thumbnailStorageId, // Convex Storageã«ä¿å­˜æ¸ˆã¿
  category: "food",
  targetSpecies: ["Dog"],
  isPremium: false, // ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚é–²è¦§å¯èƒ½
  publishedAt: Date.now(),
  createdAt: Date.now(),
  createdBy: adminUserId,
});

// ã‚­ãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§å–å¾—ï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ã€æ–°ã—ã„é †ï¼‰
const curations = await ctx.db
  .query("curations")
  .withIndex("by_category", (q) => q.eq("category", "food"))
  .filter((q) => q.eq(q.field("deletion"), undefined)) // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚‚ã®ã®ã¿
  .order("desc")
  .collect();

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œã‚ã¨ã§èª­ã‚€ã€ã«è¿½åŠ 
await ctx.db.insert("curation_interactions", {
  userId: userId,
  curationId: curationId,
  interactionType: "read_later",
  createdAt: Date.now(),
});
```

---
