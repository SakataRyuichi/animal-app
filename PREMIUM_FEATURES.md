# プレミアム限定機能リスト

**📚 ドキュメントインデックス**: [DOCUMENTATION_INDEX.md](./DOCUMENTATION_INDEX.md)

このドキュメントは、プレミアム会員のみが利用できる機能のリストです。

**関連ドキュメント**:
- [USER_STORIES.md](./USER_STORIES.md): 各ストーリーのプレミアム制限
- [CONVEX_SCHEMA.md](./CONVEX_SCHEMA.md): プレミアム権限管理の実装例
- [IMAGE_STORAGE_STRATEGY.md](./IMAGE_STORAGE_STRATEGY.md): 画像管理のプレミアム制限

## プレミアム限定機能

### Phase 1

#### 1. 画像管理機能 ✅ **Convexのプライシングを考慮した設計**
- **US-051**: 画像の最高画質表示
  - すべての画像を最高画質（数MB）で表示
  - 無料ユーザー時代にアップロードした画像も、プレミアムにアップグレードした瞬間に最高画質で表示
- **US-052**: 画像ダウンロード
  - 最高画質（ウォーターマークなし）でダウンロード
  - 編集前の「素」の状態のオリジナルデータもダウンロード可能
  - 一括ダウンロード機能（1ヶ月分をまとめて保存）
- **US-053**: 画像編集（非破壊編集）
  - 編集前・編集後の両方を保存
  - 後から編集をやり直せる
- **画像保存**: 無制限（無料ユーザーは累計50枚まで）

#### 2. 詳細な統計情報
- **US-017**: 体重推移グラフ
  - 期間を選択できる（1週間、1ヶ月、3ヶ月、1年）
  - 体重の増減傾向が分かる
- **US-072**: 統計情報表示
  - 平均食事回数
  - 平均散歩時間
  - トイレの状態の傾向
  - 期間を選択できる

#### 3. 高度なAI相談機能
- 詳細分析機能
- 過去の相談履歴の詳細表示
- 複数ペットの比較分析

### Phase 2

#### 4. 家族・チーム管理
- **US-033**: 共同管理者の追加
- **US-034**: 共同管理者一覧表示
- **US-035**: 権限の変更
- **US-036**: 共同管理者の削除
- **US-037**: 共有ペット一覧表示
- **US-038**: 共有ペットへの記録

### Phase 3（将来）

#### 5. データエクスポート
- CSV形式でのエクスポート
- PDF形式でのレポート生成
- カレンダー形式でのエクスポート

#### 6. アルバム管理機能 ✅ **思い出をテーマ別に整理**
- **US-060**: アルバム作成
  - 無制限にアルバムを作成可能（無料ユーザーは最大2つまで）
  - 1アルバム無制限にアイテムを追加可能（無料ユーザーは20枚まで）
- **US-061**: アルバムに日記・写真を追加
  - 日記詳細画面から簡単にアルバムに追加
  - 複数選択で一括追加可能
- **US-062**: アルバム一覧・詳細表示
  - テーマ別に整理された思い出を振り返れる
- **US-063**: アルバムの共有・送信
  - Webアルバム生成: 期間限定のWebサイト（閲覧専用URL）として発行
  - PDF書き出し: フォトブックのようなレイアウトでPDF化
- **US-064**: アルバムの共同編集
  - 家族で写真を出し合ってアルバムを作れる

#### 7. 思い出のアルバム作成・エクスポート ✅ **非常にセンシティブな項目 - 思い出の保護**
- **US-058**: デジタル・フォトアルバム（PDF）の作成
  - 指定期間の記録と写真をレイアウトしたPDFファイル
  - 「〇〇ちゃんの1才のあゆみ」というタイトルが自動で入る
  - メールで自分宛に送信できる
- **US-058**: 一括ダウンロード（ZIP）
  - 最高画質WebPをまとめてZIP圧縮してダウンロード
- アルバム作成前にプレビュー画面が表示され、「どの写真を入れるか」「背景の色はどうするか」を選べる
- メモリアルモードに移行した際や、退会を検討した際に、「これまでの思い出を、一生消えない宝物として書き出しましょう」と優しく提案される

#### 8. 管理者厳選のキュレーション機能 ✅ **外部記事の紹介**
- **US-079**: 管理者厳選のキュレーション一覧表示
  - ペットの種別に合わせて、関連する記事が優先的に表示される（パーソナライズ）
  - 無料ユーザー: 記事のタイトルと要約（summary）まで閲覧可能
  - プレミアムユーザー: 外部記事へのアクセスと、その記事に基づいた「AIアドバイス」の受領が可能
- **US-080**: キュレーション記事の閲覧
  - アプリ内ブラウザ（expo-web-browser）で記事を表示
  - パーソナライズされた紹介文をAIが生成
  - 「この記事について話す」ボタンでAIチャットに導線
- **US-081**: キュレーション記事の「あとで読む」機能
- **US-082**: キュレーション記事をアルバムに保存

#### 9. 高度な分析機能
- 複数ペットの比較分析
- 長期的な傾向分析

#### 10. 広告なしの快適な体験 ✅ **2026年追加 - 無料ユーザーへの広告表示**
- **US-018**: 広告表示（無料ユーザー）
  - 無料ユーザーには一部Googleなどの広告が表示される
  - 主要機能の操作を邪魔しない配置（記録入力中、アルバム全画面表示には表示しない）
  - 日記タイムラインの合間、キュレーション記事一覧、リマインダー完了後のサンクス画面に自然なカードとして表示
  - **プレミアムユーザー**: 広告が一切表示されない
  - **広告枠の差し替え**: プレミアムに切り替えた瞬間、広告が表示されていた場所が「過去の同じ日の思い出（1年前の今日）」などのパーソナライズされたコンテンツに差し替わる
- カスタムレポートの作成

#### 10. 追悼（メモリアル）プラン ✅ **2026年最終設計検証で追加**
- **US-067**: 追悼（メモリアル）プランの導入
  - ペットが虹の橋を渡り、メモリアルモードに移行した際、「追悼（メモリアル）プラン」への移行を提案
  - 月額無料または極安価で、データの保持と閲覧だけを許可する「読み取り専用」の状態
  - プレミアム会員だった期間のデータは、退会後も一定期間（例：1年間）「最高画質」でエクスポート可能
  - メモリアルプランでは、新しい記録の追加はできないが、これまでの記録と写真は最高画質で閲覧可能
  - メモリアルプランから通常のプレミアムプランに戻ることも可能（新しいペットを追加する場合など）

#### 11. ゲーミフィケーション要素 ✅ **2026年追加 - 習慣化と収益性の両立**
- **US-068**: ポイント獲得システム
  - 活動ログ（餌、トイレ、日記）を記録するたびにポイントを獲得
  - 1日の最大獲得ポイント: 30pt（餌15pt + トイレ10pt + 日記10pt）
  - 無料・プレミアム問わず、すべてのユーザーが利用可能
- **US-069**: バッジ獲得システム
  - 達成条件を満たすとバッジを獲得（例: 「健康の守護者」: 連続30日記録達成）
  - バッジは「金で買えない名誉」として設計（ポイントや現金では購入不可）
  - グローバル表示のバッジは、他のユーザーのペットプロフィールにも表示される
  - 無料・プレミアム問わず、すべてのユーザーが利用可能
- **US-070**: ショップ機能
  - ポイントでアイテムを交換、または現金で購入
  - アイテムの種類: 静止画フレーム（500pt 〜 / 300円 〜）、動くフレーム（2,000pt 〜 / 800円 〜）、アルバム表紙（1,000pt 〜 / 500円 〜）
  - 無料・プレミアム問わず、すべてのユーザーが利用可能
- **US-071**: プロフィール画面でのバッジ・アイテム表示
  - 獲得したバッジと所有しているアイテムを表示
  - 獲得したフレームは、ペットの写真に適用して表示できる

## 無料プランで利用可能な機能

以下の機能は無料プランでも利用できます：

- ペット登録・管理
- 基本的な活動ログ記録（食事、トイレ、散歩、日記、ケア）
- **画像アップロード**: 累計50枚まで（約25MB）
  - 表示用WebP（500KB程度）のみ表示可能
  - 最高画質データは裏で保存されているが、表示は制限される
- タイムライン表示
- 今日のサマリー表示
- コラム・記事の閲覧
- 基本的なAI相談機能（制限あり、または利用不可）
- 商品データベースの閲覧
- 商品レビューの閲覧・投稿
- **画像編集**: 編集後の画像のみ保存（編集前は削除）
- **画像ダウンロード**: 表示用WebP（ウォーターマーク付き）のみ
- **シンプルな画像共有**: 1枚の画像をSNS/メッセージで共有（無料ユーザーも利用可能）
- **アルバム管理**: 最大2つまで作成可能、1アルバム20枚まで（プレミアムユーザーは無制限）
- **キュレーション機能**: 記事のタイトルと要約（summary）まで閲覧可能（プレミアムユーザーは外部記事へのアクセスとAIアドバイスが可能）
- **追悼（メモリアル）プラン**: ペットが虹の橋を渡った後、月額無料または極安価でデータの保持と閲覧が可能 ✅ **2026年最終設計検証で追加**
- **ゲーミフィケーション要素**: ポイント獲得、バッジ獲得、ショップ機能（すべて無料・プレミアム問わず利用可能） ✅ **2026年追加**
- **広告表示**: 無料ユーザーには一部Googleなどの広告が表示される ✅ **2026年追加**
  - 主要機能の操作を邪魔しない配置（記録入力中、アルバム全画面表示には表示しない）
  - 日記タイムラインの合間、キュレーション記事一覧、リマインダー完了後のサンクス画面に自然なカードとして表示
  - プレミアムにアップグレードすると広告が消え、「思い出枠」などのパーソナライズされたコンテンツに差し替わる

## 実装方針

### バックエンド（Convex）

プレミアム限定機能のQuery/Mutationでは、冒頭で`assertPremium()`を呼び出します：

```typescript
import { assertPremium } from "./lib/permissions";

export const getDetailedStats = query({
  handler: async (ctx) => {
    // プレミアム会員であることを要求
    await assertPremium(ctx);
    
    // プレミアム限定の処理
    // ...
  },
});
```

### フロントエンド（React）

プレミアム限定画面では、`PremiumGuard`コンポーネントでラップします：

```typescript
import { PremiumGuard } from "@repo/ui";

export default function DetailedStatsScreen() {
  return (
    <PremiumGuard>
      <DetailedStatsContent />
    </PremiumGuard>
  );
}
```

### UI/UX

プレミアム限定機能には、以下の3段階の案内を実装します：

1. **ロックアイコンの表示**: プレミアム機能の横に小さな鍵アイコン
2. **ハーフモーダル（Sheet）**: 機能をクリックした際に下から表示される案内
3. **プレースホルダー**: プレミアム限定の統計画面などは、ぼかし（Blur）をかけた背景に案内テキスト

## 参考ドキュメント

- `CONVEX_SCHEMA.md`: スキーマ定義（`users.subscription`）
- `USER_STORIES.md`: ユーザーストーリー（US-019-1, US-019-2, US-019-3）
- `packages/backend/convex/lib/permissions.ts`: 権限管理ヘルパー関数
- `packages/ui/src/components/PremiumGuard.tsx`: プレミアムガードコンポーネント
