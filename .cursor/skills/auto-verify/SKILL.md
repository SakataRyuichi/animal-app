---
name: auto-verify
description: 開発後の自動検証フロー（テスト、リント、型チェック、デバッグ）
---

# 自動検証スキル

コード変更後の自動検証とデバッグを実行する包括的なスキルです。

## 自動検証フロー

コード変更が完了したら、以下の順序で自動検証を実行してください：

### Phase 1: 静的解析

1. **型チェック** (`pnpm typecheck`)
   ```bash
   pnpm typecheck
   ```
   - TypeScriptの型エラーがないか確認
   - エラーがあれば修正してから次へ進む

2. **リント** (`pnpm lint`)
   ```bash
   pnpm lint
   ```
   - ESLintのエラーと警告を確認
   - 自動修正可能なエラーを修正 (`pnpm lint --fix`)
   - 手動修正が必要なエラーを報告

3. **フォーマット** (`pnpm format`)
   ```bash
   pnpm format
   ```
   - Prettierでコードをフォーマット
   - 一貫性のあるコードスタイルを維持

### Phase 2: テスト

4. **ユニットテスト** (`pnpm test`)
   ```bash
   pnpm test
   ```
   - 変更されたパッケージのテストを実行
   - 失敗があれば修正
   - 新機能の場合はテストを追加

5. **E2Eテスト** (必要に応じて)
   ```bash
   pnpm maestro test
   ```
   - 重要なフローのE2Eテストを実行
   - 時間がかかるため、必要に応じてのみ実行

### Phase 3: ビルド確認

6. **ビルド** (`pnpm build`)
   ```bash
   pnpm build
   ```
   - 変更されたパッケージをビルド
   - ビルドエラーがないか確認

### Phase 4: 結果の要約

7. **検証結果の報告**
   - すべての検証が成功したことを確認
   - 修正した内容を要約
   - 残っている問題があれば報告

## デバッグフロー

問題が発生した場合のデバッグ手順：

### Step 1: 問題の再現

- 問題を再現する手順を確認
- エラーメッセージを完全に確認
- 問題が発生している環境を確認

### Step 2: ログの追加

```typescript
// デバッグログを追加
console.log("[DEBUG] Function called with:", { args });
console.log("[DEBUG] Current state:", { state });
```

### Step 3: テストの追加

```typescript
// 問題を再現するテストを追加
test("should reproduce the issue", async () => {
  // 問題を再現するコード
  expect(result).toBe(expected);
});
```

### Step 4: 根本原因の特定

- ログとエラーメッセージを分析
- 関連するコードを確認
- 問題の根本原因を特定

### Step 5: 修正と検証

- 根本原因を修正
- テストを実行して問題が解決したことを確認
- 再度自動検証フローを実行

## 使用例

### 基本的な使用

```
コードを変更しました。自動検証フローを実行してください。
```

### 特定のパッケージのみ検証

```
apps/expoのコードを変更しました。モバイルアプリの検証のみ実行してください。
```

### デバッグを含む

```
この問題をデバッグしてください。まず、問題を再現するテストを追加してから修正してください。
```

## 検証チェックリスト

コード変更後、以下を確認：

- [ ] TypeScriptの型エラーがない (`pnpm typecheck`)
- [ ] ESLintのエラーがない (`pnpm lint`)
- [ ] コードがフォーマットされている (`pnpm format`)
- [ ] テストがすべて成功 (`pnpm test`)
- [ ] ビルドが成功 (`pnpm build`)
- [ ] 新機能にはテストが追加されている
- [ ] エラーハンドリングが適切

## 注意事項

- 各ステップでエラーが発生した場合は、修正してから次のステップに進む
- 検証に時間がかかる場合は、進捗を報告
- 自動検証フローは、コードの品質を保証するためのものです
- 問題が解決しない場合は、デバッグフローを実行
