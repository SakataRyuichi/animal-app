# ç”»åƒãƒ»å‹•ç”»ä¿å­˜æˆ¦ç•¥

**ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: [DOCUMENTATION_INDEX.md](./DOCUMENTATION_INDEX.md)

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [CONVEX_SCHEMA.md](./CONVEX_SCHEMA.md): imagesãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾©
- [PREMIUM_FEATURES.md](./PREMIUM_FEATURES.md): ç”»åƒç®¡ç†ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½
- [USER_STORIES.md](./USER_STORIES.md): US-051ã€œUS-054ï¼ˆç”»åƒç®¡ç†æ©Ÿèƒ½ï¼‰ã€US-092ã€œUS-095ï¼ˆå‹•ç”»ç®¡ç†æ©Ÿèƒ½ï¼‰ âœ… **2026å¹´è¿½åŠ **
- [CLOUDFLARE_R2_MIGRATION.md](./CLOUDFLARE_R2_MIGRATION.md): Cloudflare R2ç§»è¡Œè¨­è¨ˆ âœ… **2026å¹´è¿½åŠ **

**ä½œæˆæ—¥**: 2026å¹´2æœˆ1æ—¥  
**æœ€çµ‚æ›´æ–°**: 2026å¹´2æœˆ1æ—¥ï¼ˆCloudflare R2ç§»è¡Œãƒ»å‹•ç”»å¯¾å¿œï¼‰  
**ç›®çš„**: Cloudflare R2ã‚’æ´»ç”¨ã—ãŸç”»åƒãƒ»å‹•ç”»ä¿å­˜æˆ¦ç•¥ã¨ã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã¨ã—ã¦ã®ç”»åƒãƒ»å‹•ç”»ç®¡ç†æ©Ÿèƒ½ã®è¨­è¨ˆ

---

## 1. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æˆ¦ç•¥ã®å¤‰æ›´ âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œ**

### 1.1 Cloudflare R2ã¸ã®ç§»è¡Œ

**ç§»è¡Œç†ç”±**:
- **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: ä¸‹ã‚Šé€šä¿¡æ–™ï¼ˆEgress Feeï¼‰ãŒå®Œå…¨ã«ç„¡æ–™
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**: Cloudflare CDNã¨ã®çµ±åˆã«ã‚ˆã‚Šã€ä¸–ç•Œä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é«˜é€Ÿãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å‹•ç”»ã®ã‚ˆã†ãªå¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ‰±ã„ã‚„ã™ã„

**è©³ç´°**: `CLOUDFLARE_R2_MIGRATION.md`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 1.2 Cloudflare R2ã®ç„¡æ–™æ ã¨åˆ¶é™

- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: 10GBã¾ã§ç„¡æ–™ã€10GBè¶…ã¯$0.015/GB/æœˆï¼ˆç´„2.25å††/GB/æœˆï¼‰
- **å¸¯åŸŸå¹…ï¼ˆEgress Feeï¼‰**: **å®Œå…¨ã«ç„¡æ–™**ï¼ˆ$0ï¼‰
- **æ“ä½œï¼ˆOperationsï¼‰**: Class Aï¼ˆæ›¸ãè¾¼ã¿ï¼‰$4.50/ç™¾ä¸‡å›ã€Class Bï¼ˆèª­ã¿è¾¼ã¿ï¼‰$0.36/ç™¾ä¸‡å›

### 1.3 ç”»åƒãƒ‡ãƒ¼ã‚¿é‡ã®è©¦ç®—

**å‰ææ¡ä»¶**:
- ã‚¹ãƒãƒ›ç”»åƒ1æšã‚ãŸã‚Šï¼ˆåœ§ç¸®å‰ï¼‰: 3MB ã€œ 6MBï¼ˆJPEG/HEICï¼‰
- WebPå½¢å¼ï¼ˆåœ§ç¸®å¾Œï¼‰:
  - è¡¨ç¤ºç”¨ï¼ˆPreviewï¼‰: ç´„250KB ã€œ 500KBï¼ˆå¹…1080pxã€Quality 0.6-0.7ï¼‰
  - æœ€é«˜ç”»è³ªï¼ˆOriginalï¼‰: ç´„1.5MB ã€œ 3MBï¼ˆãƒªã‚µã‚¤ã‚ºãªã—ã€Quality 0.9-1.0ï¼‰

**1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®æœˆé–“ãƒ‡ãƒ¼ã‚¿é‡**ï¼ˆ1æ—¥1æšã€æœˆ30æšã¨ä»®å®šï¼‰:
- è¡¨ç¤ºç”¨ã®ã¿: 30æš Ã— 500KB = 15MB / æœˆ
- æœ€é«˜ç”»è³ªã‚‚ä¿å­˜: 30æš Ã— 2.5MB = 75MB / æœˆ

**ç„¡æ–™æ ï¼ˆ10GBï¼‰ã§è€ãˆã‚‰ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**ï¼ˆCloudflare R2ï¼‰:
- è¡¨ç¤ºç”¨ã®ã¿: ç´„660,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰
- æœ€é«˜ç”»è³ªã‚‚ä¿å­˜: ç´„130,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰

### 1.4 å‹•ç”»ãƒ‡ãƒ¼ã‚¿é‡ã®è©¦ç®— âœ… **2026å¹´è¿½åŠ **

**å‰ææ¡ä»¶**:
- iOS/Androidã®ä¸»è¦ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯: HEVC (H.265)
- åœ§ç¸®è¨­å®š:
  - ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼: 720p/30fps/HEVCï¼ˆç´„15-20MB/åˆ†ï¼‰
  - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1080p/30fps/HEVCï¼ˆç´„30-40MB/åˆ†ï¼‰

**1ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šã®æœˆé–“ãƒ‡ãƒ¼ã‚¿é‡**ï¼ˆå‹•ç”»ï¼‰:
- **ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æœˆé–“3æœ¬ã€å„15ç§’ = 3æœ¬ Ã— 0.25åˆ† Ã— 17.5MB = ç´„13MB/æœˆ
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æœˆé–“10æœ¬ã€å„60ç§’ = 10æœ¬ Ã— 1åˆ† Ã— 35MB = ç´„350MB/æœˆ

**ç„¡æ–™æ ï¼ˆ10GBï¼‰ã§è€ãˆã‚‰ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**ï¼ˆå‹•ç”»ã®ã¿ï¼‰:
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿: ç´„770ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆ
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿: ç´„28ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆ
- æ··åˆï¼ˆç„¡æ–™:ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  = 9:1ï¼‰: ç´„250ãƒ¦ãƒ¼ã‚¶ãƒ¼/æœˆ

---

## 2. ãƒ•ãƒªãƒ¼ï¼ˆç„¡æ–™ï¼‰ã¨ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã®å¢ƒç•Œç·š

| æ©Ÿèƒ½ | ãƒ•ãƒªãƒ¼ï¼ˆç„¡æ–™ï¼‰ | ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  | ç‹™ã„ |
|------|---------------|-----------|------|
| **åŸºæœ¬ã®è¨˜éŒ²** | ç„¡åˆ¶é™ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰ | ç„¡åˆ¶é™ | æ¯æ—¥ä½¿ã£ã¦ã‚‚ã‚‰ã„ã€é›¢è„±ã‚’é˜²ãï¼ˆç¿’æ…£åŒ–ï¼‰ |
| **ç”»åƒä¿å­˜** | ç´¯è¨ˆ50æšã¾ã§ï¼ˆç´„25MBï¼‰ã¾ãŸã¯ç›´è¿‘1ãƒ¶æœˆåˆ†ã®ã¿è¡¨ç¤º | ç„¡åˆ¶é™ï¼ˆã¾ãŸã¯å¤§å®¹é‡ï¼‰ | Cloudflare R2ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆã‚’è»¢å« |
| **ç”»åƒç”»è³ª** | è¡¨ç¤ºç”¨WebPï¼ˆ500KBç¨‹åº¦ï¼‰ã®ã¿ | æœ€é«˜ç”»è³ªWebPï¼ˆæ•°MBï¼‰ã‚‚ä¿å­˜ãƒ»è¡¨ç¤ºå¯èƒ½ | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆã®å›å |
| **ç”»åƒç·¨é›†** | ç·¨é›†å¾Œã®ç”»åƒã®ã¿ä¿å­˜ï¼ˆç·¨é›†å‰ã¯å‰Šé™¤ï¼‰ | ç·¨é›†å‰ãƒ»ç·¨é›†å¾Œã®ä¸¡æ–¹ã‚’ä¿å­˜ï¼ˆéç ´å£Šç·¨é›†ï¼‰ | ä»˜åŠ ä¾¡å€¤ã®æä¾› |
| **ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰** | è¡¨ç¤ºç”¨WebPã®ã¿ï¼ˆã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ä»˜ãï¼‰ | æœ€é«˜ç”»è³ªWebPï¼ˆã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ãªã—ï¼‰ã€ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ | åç›ŠåŒ–ã¨ä»˜åŠ ä¾¡å€¤ |
| **å‹•ç”»ä¿å­˜** âœ… **2026å¹´è¿½åŠ ** | 1æœ¬ã‚ãŸã‚Šæœ€å¤§15ç§’ã€1ãƒšãƒƒãƒˆã«ã¤ãæœˆé–“3æœ¬ã¾ã§ã€720p/HEVC | 1æœ¬ã‚ãŸã‚Šæœ€å¤§60ç§’ã€ç„¡åˆ¶é™ã€1080p/HEVC | å‹•ç”»ã®å®¹é‡ã¨ã‚³ã‚¹ãƒˆã‚’è€ƒæ…®ã—ãŸåˆ¶é™ |
| **å‹•ç”»å†ç”Ÿ** âœ… **2026å¹´è¿½åŠ ** | å¯èƒ½ï¼ˆCloudflare CDNçµŒç”±ï¼‰ | å¯èƒ½ï¼ˆCloudflare CDNçµŒç”±ï¼‰ | ä¸‹ã‚Šé€šä¿¡æ–™ç„¡æ–™ã®ãŸã‚ã€ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚é«˜é€Ÿå†ç”Ÿå¯èƒ½ |
| **å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰** âœ… **2026å¹´è¿½åŠ ** | ä¸å¯ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ¡ˆå†…ï¼‰ | å¯èƒ½ï¼ˆHEVCå½¢å¼ï¼‰ | åç›ŠåŒ–ã¨ä»˜åŠ ä¾¡å€¤ |
| **AIãƒãƒ£ãƒƒãƒˆ** | ãªã—ï¼ˆã¾ãŸã¯1æ—¥1å›ï¼‰ | ç„¡åˆ¶é™ | APIã‚³ã‚¹ãƒˆã®å›åã¨ä»˜åŠ ä¾¡å€¤ã®æä¾› |
| **å®¶æ—å…±æœ‰** | 2äººã¾ã§ | ç„¡åˆ¶é™ï¼ˆè¦ªæˆšã‚‚æ‹›å¾…å¯ï¼‰ | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ‹¡å¤§ã¨å®šç€ |
| **ãƒ‡ãƒ¼ã‚¿æ›¸ãå‡ºã—** | ãªã— | PDF/CSVå‡ºåŠ› | ã€Œå¤§åˆ‡ãªè¨˜éŒ²ã‚’æ®‹ã—ãŸã„ã€å±¤ã®ç²å¾— |

---

## 3. ç”»åƒãƒ»å‹•ç”»ä¿å­˜ã®è¨­è¨ˆæ€æƒ³ âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œãƒ»å‹•ç”»å¯¾å¿œ**

### 3.1 Cloudflare R2ã¸ã®ç§»è¡Œ âœ… **2026å¹´è¿½åŠ **

**ç§»è¡Œã®ãƒ¡ãƒªãƒƒãƒˆ**:
- **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: ä¸‹ã‚Šé€šä¿¡æ–™ï¼ˆEgress Feeï¼‰ãŒå®Œå…¨ã«ç„¡æ–™ã®ãŸã‚ã€å‹•ç”»å†ç”Ÿæ™‚ã®ã‚³ã‚¹ãƒˆãŒå¤§å¹…ã«å‰Šæ¸›
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š**: Cloudflare CDNã¨ã®çµ±åˆã«ã‚ˆã‚Šã€ä¸–ç•Œä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é«˜é€Ÿãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: å‹•ç”»ã®ã‚ˆã†ãªå¤§å®¹é‡ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚æ‰±ã„ã‚„ã™ã„

**è©³ç´°**: `CLOUDFLARE_R2_MIGRATION.md`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 3.2 ãƒ€ãƒ–ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹é€ 

**ã€Œæ¸©ã‹ã¿ã¨èª å®Ÿã•ã€ã‚’æ„Ÿã˜ã•ã›ã‚‹è¨­è¨ˆ**:
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç”»åƒã‚‚ã€**è£ã§æœ€é«˜ç”»è³ªãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜**
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ãŸç¬é–“ã€éå»ã®å…¨ã¦ã®å†™çœŸãŒç¾ã—ããªã‚‹ã€Œãƒã‚¸ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆã€ã‚’å®Ÿç¾
- ã€Œãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆã—ã¦ã„ãªã„ï¼ˆæ¸©ã‹ã¿ï¼‰ã€ã¨ã€Œä»Šã™ãã¯è¦‹ã‚‰ã‚Œãªã„ï¼ˆåˆ¶é™ï¼‰ã€ã‚’ä¸¡ç«‹

### 3.3 WebPå½¢å¼ã®æ¡ç”¨ï¼ˆç”»åƒï¼‰

**2026å¹´ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã€WebPã¯å¿…é ˆã®æ¨™æº–**:
- JPEG/PNGã¨æ¯”è¼ƒã—ã¦ã€åŒç­‰ã®ç”»è³ªã§25%ã€œ34%ã‚‚è»½é‡
- Cloudflare R2ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ–™é‡‘ã‚’æŠ‘ãˆã‚‰ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€šä¿¡é‡ï¼ˆã‚®ã‚¬ï¼‰ã®ç¯€ç´„
- ã‚¢ãƒ—ãƒªã®èª­ã¿è¾¼ã¿é€Ÿåº¦ï¼ˆUXï¼‰ã®å‘ä¸Š

### 3.4 HEVCå½¢å¼ã®æ¡ç”¨ï¼ˆå‹•ç”»ï¼‰ âœ… **2026å¹´è¿½åŠ **

**2026å¹´ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªé–‹ç™ºã«ãŠã„ã¦ã€HEVC (H.265) ã¯æ¨™æº–**:
- iOS/Androidã®åŒæ–¹ã§ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åŠ é€ŸãŒå®Œå…¨ã«æ™®åŠ
- H.264ã®ç´„åŠåˆ†ã®å®¹é‡ã§åŒç­‰ã®ç”»è³ªã‚’ç¶­æŒ
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼: 720p/30fps/HEVCï¼ˆç´„15-20MB/åˆ†ï¼‰
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1080p/30fps/HEVCï¼ˆç´„30-40MB/åˆ†ï¼‰

### 3.5 å‹•ç”»ã®è‡ªå‹•åœ§ç¸® âœ… **2026å¹´è¿½åŠ **

**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®åœ§ç¸®**:
- Expoï¼ˆReact Nativeï¼‰ã§`expo-video-compressor`ã‚’ä½¿ç”¨
- ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‰ã«è‡ªå‹•ã§åœ§ç¸®ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ„è­˜ã›ãšã«æœ€é©ãªã‚µã‚¤ã‚ºã§ä¿å­˜ï¼‰
- ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ: å‹•ç”»ã®æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‰è‡ªå‹•ã§ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã‚’ç”Ÿæˆ

### 3.6 ç”»åƒç·¨é›†æ©Ÿèƒ½ã®è¨­è¨ˆ

**Instagramã®ã‚ˆã†ãªç·¨é›†æ©Ÿèƒ½**:
- **ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç·¨é›†å¾Œã®ç”»åƒã®ã¿ä¿å­˜ï¼ˆç·¨é›†å‰ã¯ä¸Šæ›¸ãã¾ãŸã¯å‰Šé™¤ï¼‰
- **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼**:
  - ç·¨é›†å‰ï¼ˆæœ€é«˜ç”»è³ªï¼‰
  - ç·¨é›†å¾Œï¼ˆè¡¨ç¤ºç”¨WebPï¼‰
  - ç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¹ã‚¿ãƒ³ãƒ—ã®ä½ç½®ã‚„æ–‡å­—ã®å†…å®¹ï¼‰
  - å¾Œã‹ã‚‰ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å‹•ã‹ã—ãŸã‚Šæ–‡å­—ã‚’æ›¸ãæ›ãˆãŸã‚Šã§ãã‚‹ã€Œéç ´å£Šç·¨é›†ã€

---

## 4. ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œãƒ»å‹•ç”»å¯¾å¿œ**

### 4.1 imagesãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆç”»åƒãƒ»å‹•ç”»ç®¡ç†ï¼‰âœ… **2026å¹´æ›´æ–°**

ç”»åƒãƒ»å‹•ç”»ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã€‚

```typescript
// convex/schema.ts
images: defineTable({
  userId: v.id("users"),
  petId: v.optional(v.id("pets")), // ãƒšãƒƒãƒˆé–¢é€£ã®ç”»åƒãƒ»å‹•ç”»ã®å ´åˆ
  activityId: v.optional(v.id("activities")), // æ´»å‹•ãƒ­ã‚°é–¢é€£ã®ç”»åƒãƒ»å‹•ç”»ã®å ´åˆ

  // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¿ã‚¤ãƒ— âœ… **2026å¹´è¿½åŠ **
  mediaType: v.union(v.literal("image"), v.literal("video")), // ç”»åƒ or å‹•ç”»

  // Cloudflare R2é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ âœ… **2026å¹´è¿½åŠ **
  r2Key: v.string(), // R2ä¸Šã®ãƒ‘ã‚¹ï¼ˆä¾‹: pets/123/image_abc.webpï¼‰
  r2Url: v.string(), // ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³çµŒç”±ã®URLï¼ˆä¾‹: https://assets.your-pet-app.com/pets/123/image_abc.webpï¼‰
  thumbnailR2Key: v.optional(v.string()), // ã‚µãƒ ãƒã‚¤ãƒ«ã®R2ã‚­ãƒ¼ï¼ˆå‹•ç”»ç”¨ï¼‰
  thumbnailR2Url: v.optional(v.string()), // ã‚µãƒ ãƒã‚¤ãƒ«ã®URLï¼ˆå‹•ç”»ç”¨ï¼‰

  // å‹•ç”»é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ âœ… **2026å¹´è¿½åŠ **
  videoDuration: v.optional(v.number()), // å‹•ç”»ã®é•·ã•ï¼ˆç§’ï¼‰
  videoCodec: v.optional(v.string()), // ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ï¼ˆHEVC, AV1ãªã©ï¼‰
  videoResolution: v.optional(v.string()), // è§£åƒåº¦ï¼ˆ720p, 1080pãªã©ï¼‰

  // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ã€æ—¢å­˜ã®Convex Storage IDã‚‚ä¿æŒï¼ˆç§»è¡ŒæœŸé–“ä¸­ï¼‰âœ… **2026å¹´è¿½åŠ **
  // 1. è¡¨ç¤ºç”¨ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚‚å‚ç…§å¯èƒ½ / 500KBç¨‹åº¦ï¼‰
  previewStorageId: v.optional(v.string()), // WebPå½¢å¼ã€å¹…1080pxã€Quality 0.6-0.7ï¼ˆç§»è¡Œå®Œäº†å¾Œã«å‰Šé™¤äºˆå®šï¼‰
  
  // 2. æœ€é«˜ç”»è³ªï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿å‚ç…§å¯èƒ½ / æ•°MBä»¥ä¸Šï¼‰
  originalStorageId: v.optional(v.string()), // WebPå½¢å¼ã€ãƒªã‚µã‚¤ã‚ºãªã—ã€Quality 0.9-1.0ï¼ˆç§»è¡Œå®Œäº†å¾Œã«å‰Šé™¤äºˆå®šï¼‰
  
  // 3. ç·¨é›†ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã®ã¿ï¼šã‚¹ã‚¿ãƒ³ãƒ—ã®ä½ç½®ãªã©ï¼‰
  editMetadata: v.optional(
    v.object({
      // ç·¨é›†å‰ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ï¼ˆç·¨é›†ã‚’å…ƒã«æˆ»ã™ãŸã‚ï¼‰
      originalBeforeEditStorageId: v.optional(v.string()),
      // ã‚¹ã‚¿ãƒ³ãƒ—ã®ä½ç½®ãƒ»ç¨®é¡
      stamps: v.optional(
        v.array(
          v.object({
            type: v.string(), // ã‚¹ã‚¿ãƒ³ãƒ—ã®ç¨®é¡
            x: v.number(), // Xåº§æ¨™
            y: v.number(), // Yåº§æ¨™
            scale: v.number(), // ã‚¹ã‚±ãƒ¼ãƒ«
            rotation: v.number(), // å›è»¢è§’åº¦
          })
        )
      ),
      // æ–‡å­—ã®ä½ç½®ãƒ»å†…å®¹
      texts: v.optional(
        v.array(
          v.object({
            content: v.string(), // æ–‡å­—å†…å®¹
            x: v.number(), // Xåº§æ¨™
            y: v.number(), // Yåº§æ¨™
            fontSize: v.number(), // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º
            color: v.string(), // è‰²ï¼ˆHEXï¼‰
            fontFamily: v.string(), // ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼
          })
        )
      ),
    })
  ),
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  width: v.number(), // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®å¹…
  height: v.number(), // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®é«˜ã•
  fileSizeOriginal: v.number(), // ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  fileSizePreview: v.number(), // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  format: v.string(), // "webp"
  
  // ç·¨é›†çŠ¶æ…‹
  hasEdits: v.boolean(), // ç·¨é›†ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹
  isPremiumAtUpload: v.boolean(), // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼çŠ¶æ…‹ï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‹ã©ã†ã‹ï¼‰
  
  // å‰Šé™¤çŠ¶æ…‹
  deletion: deletionSchema,
  
  createdAt: v.number(),
})
  .index("by_user", ["userId"])
  .index("by_pet", ["petId"])
  .index("by_activity", ["activityId"])
  .index("by_user_active", ["userId", "deletion"]), // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªç”»åƒã®ã¿å–å¾—ç”¨
```

### 4.2 usersãƒ†ãƒ¼ãƒ–ãƒ«ã®æ‹¡å¼µ

ç”»åƒåˆ¶é™ã‚’ç®¡ç†ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```typescript
users: defineTable({
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  
  // ç”»åƒåˆ¶é™ç®¡ç†
  imageCount: v.number(), // ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ç´¯è¨ˆæšæ•°ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ¶é™ãƒã‚§ãƒƒã‚¯ç”¨ï¼‰
  imageStorageUsedBytes: v.number(), // ä½¿ç”¨ä¸­ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®¹é‡ï¼ˆãƒã‚¤ãƒˆï¼‰
  
  // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†
  subscription: v.object({
    tier: v.union(v.literal("free"), v.literal("premium")),
    status: v.union(
      v.literal("active"),
      v.literal("canceled"),
      v.literal("past_due"),
      v.literal("trialing")
    ),
    endsAt: v.optional(v.number()),
    gracePeriodEndsAt: v.optional(v.number()),
    revenueCatUserId: v.optional(v.string()),
  }),
}),
```

### 4.3 activitiesãƒ†ãƒ¼ãƒ–ãƒ«ã®æ›´æ–°

`payload.images`ã‚’`imageIds`ï¼ˆ`images`ãƒ†ãƒ¼ãƒ–ãƒ«ã®IDé…åˆ—ï¼‰ã«å¤‰æ›´ã—ã¾ã™ã€‚

```typescript
activities: defineTable({
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  
  payload: v.object({
    // å…±é€š
    imageIds: v.optional(v.array(v.id("images"))), // ç”»åƒIDã®é…åˆ—ï¼ˆimagesãƒ†ãƒ¼ãƒ–ãƒ«ã¸ã®å‚ç…§ï¼‰
    text: v.optional(v.string()),
    
    // ... ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  }),
}),
```

---

## 5. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»å‡¦ç†ãƒ•ãƒ­ãƒ¼

### 5.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆExpoï¼‰ã§ã®å‡¦ç†

```typescript
// apps/expo/utils/imageProcessor.ts
import * as ImageManipulator from 'expo-image-manipulator';

/**
 * ç”»åƒã‚’2ç¨®é¡ã®WebPã«å¤‰æ›
 * 1. è¡¨ç¤ºç”¨ï¼ˆPreviewï¼‰: å¹…1080pxã€Quality 0.6-0.7
 * 2. æœ€é«˜ç”»è³ªï¼ˆOriginalï¼‰: ãƒªã‚µã‚¤ã‚ºãªã—ã€Quality 0.9-1.0
 */
export async function processImageForUpload(uri: string) {
  // 1. è¡¨ç¤ºç”¨ WebP ã®ç”Ÿæˆï¼ˆè»½é‡ï¼‰
  const preview = await ImageManipulator.manipulateAsync(
    uri,
    [{ resize: { width: 1080 } }],
    { compress: 0.6, format: ImageManipulator.SaveFormat.WEBP }
  );

  // 2. æœ€é«˜ç”»è³ª WebP ã®ç”Ÿæˆï¼ˆé«˜ç²¾ç´°ï¼‰
  const original = await ImageManipulator.manipulateAsync(
    uri,
    [], // ãƒªã‚µã‚¤ã‚ºãªã—
    { compress: 0.9, format: ImageManipulator.SaveFormat.WEBP }
  );

  return {
    preview: {
      uri: preview.uri,
      width: preview.width,
      height: preview.height,
      fileSize: await getFileSize(preview.uri),
    },
    original: {
      uri: original.uri,
      width: original.width,
      height: original.height,
      fileSize: await getFileSize(original.uri),
    },
  };
}
```

### 5.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆConvex Actionï¼‰ã§ã®å‡¦ç† âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œ**

```typescript
// packages/backend/convex/actions/r2.ts
import { internalAction } from "./_generated/server";
import { S3Client, PutObjectCommand } from "@aws-sdk/client-s3";
import { getSignedUrl } from "@aws-sdk/s3-request-presigner";

// Presigned URLã®ç™ºè¡Œï¼ˆç”»åƒãƒ»å‹•ç”»å…±é€šï¼‰
export const generateR2UploadUrl = internalAction({
  args: {
    r2Key: v.string(), // ä¾‹: pets/123/image_abc.webp
    contentType: v.string(), // ä¾‹: image/webp, video/mp4
    fileSize: v.number(), // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆï¼‰
  },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯
    const MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB
    if (args.fileSize > MAX_FILE_SIZE) {
      throw new Error("ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™");
    }
    
    const s3Client = new S3Client({
      region: "auto",
      endpoint: process.env.CLOUDFLARE_R2_ENDPOINT,
      credentials: {
        accessKeyId: process.env.CLOUDFLARE_R2_ACCESS_KEY_ID!,
        secretAccessKey: process.env.CLOUDFLARE_R2_SECRET_ACCESS_KEY!,
      },
    });
    
    const command = new PutObjectCommand({
      Bucket: process.env.CLOUDFLARE_R2_BUCKET_NAME!,
      Key: args.r2Key,
      ContentType: args.contentType,
    });
    
    // Presigned URLã‚’ç™ºè¡Œï¼ˆæœ‰åŠ¹æœŸé™: 5åˆ†ï¼‰
    const signedUrl = await getSignedUrl(s3Client, command, { expiresIn: 300 });
    
    return {
      uploadUrl: signedUrl,
      publicUrl: `${process.env.CLOUDFLARE_R2_PUBLIC_URL}/${args.r2Key}`,
    };
  },
});

// ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆR2çµŒç”±ï¼‰âœ… **2026å¹´æ›´æ–°**
export const uploadImage = action({
  args: {
    petId: v.optional(v.id("pets")),
    activityId: v.optional(v.id("activities")),
    previewFile: v.string(), // Base64ã¾ãŸã¯Blob
    originalFile: v.string(), // Base64ã¾ãŸã¯Blob
    width: v.number(),
    height: v.number(),
    fileSizeOriginal: v.number(),
    fileSizePreview: v.number(),
  },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) throw new Error("èªè¨¼ãŒå¿…è¦ã§ã™");

    const user = await ctx.runQuery(api.users.getCurrentUser);

    // ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã€ç”»åƒæšæ•°åˆ¶é™ã‚’ãƒã‚§ãƒƒã‚¯
    if (user.subscription.tier === "free") {
      const FREE_IMAGE_LIMIT = 50; // ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ç´¯è¨ˆ50æšã¾ã§
      if (user.imageCount >= FREE_IMAGE_LIMIT) {
        throw new Error("IMAGE_LIMIT_REACHED");
      }
    }

    // R2ã‚­ãƒ¼ã®ç”Ÿæˆ
    const imageId = generateId(); // ä¸€æ„ã®IDã‚’ç”Ÿæˆ
    const previewR2Key = `images/${imageId}/preview.webp`;
    const originalR2Key = `images/${imageId}/original.webp`;

    // Presigned URLã‚’å–å¾—
    const previewUrl = await ctx.runAction(api.r2.generateR2UploadUrl, {
      r2Key: previewR2Key,
      contentType: "image/webp",
      fileSize: args.fileSizePreview,
    });
    const originalUrl = await ctx.runAction(api.r2.generateR2UploadUrl, {
      r2Key: originalR2Key,
      contentType: "image/webp",
      fileSize: args.fileSizeOriginal,
    });

    // R2ã«ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§å®Ÿè¡Œï¼‰
    // ã“ã“ã§ã¯Presigned URLã‚’è¿”ã™ã ã‘

    // imagesãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
    const savedImageId = await ctx.runMutation(api.images.create, {
      userId: user._id,
      petId: args.petId,
      activityId: args.activityId,
      previewStorageId,
      originalStorageId,
      width: args.width,
      height: args.height,
      fileSizeOriginal: args.fileSizeOriginal,
      fileSizePreview: args.fileSizePreview,
      format: "webp",
      hasEdits: false,
      isPremiumAtUpload: user.subscription.tier === "premium",
    });

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»åƒã‚«ã‚¦ãƒ³ãƒˆã‚’æ›´æ–°
    await ctx.runMutation(api.users.incrementImageCount, {
      userId: user._id,
      imageStorageUsedBytes: args.fileSizeOriginal + args.fileSizePreview,
    });

    return imageId;
  },
});
```

---

## 6. ç”»åƒãƒ»å‹•ç”»è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œ**

### 6.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®è¡¨ç¤ºï¼ˆR2çµŒç”±ï¼‰âœ… **2026å¹´æ›´æ–°**

```typescript
// packages/ui/src/components/PetImage.tsx
import { useQuery } from "convex/react";
import { api } from "@repo/backend/convex/_generated/api";

export function PetImage({ imageId }: { imageId: Id<"images"> }) {
  const user = useQuery(api.users.getCurrentUser);
  const image = useQuery(api.images.getById, { imageId });

  if (!image || !user) return null;

  // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åˆ¤å®š
  const isPremium = user.subscription.tier === "premium" && 
    (user.subscription.status === "active" || 
     user.subscription.status === "trialing" ||
     (user.subscription.status === "past_due" && 
      user.subscription.gracePeriodEndsAt && 
      Date.now() < user.subscription.gracePeriodEndsAt));

  // R2 URLã‚’ä½¿ç”¨ï¼ˆCloudflare CDNçµŒç”±ã§é«˜é€Ÿé…ä¿¡ï¼‰âœ… **2026å¹´æ›´æ–°**
  const imageUrl = image.r2Url; // ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³çµŒç”±ã®URL

  // R2 URLã‚’ä½¿ç”¨ï¼ˆCloudflare CDNçµŒç”±ã§é«˜é€Ÿé…ä¿¡ï¼‰âœ… **2026å¹´æ›´æ–°**
  // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãªã‚‰æœ€é«˜ç”»è³ªã€ãã†ã§ãªã‘ã‚Œã°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®URLã‚’ä½¿ç”¨
  const imageUrl = isPremium && image.r2Url
    ? image.r2Url // æœ€é«˜ç”»è³ªã®R2 URL
    : image.thumbnailR2Url || image.r2Url; // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¾ãŸã¯ã‚µãƒ ãƒã‚¤ãƒ«ã®R2 URL

  return (
    <View>
      <Image source={{ uri: imageUrl }} style={styles.petPhoto} />
      {!isPremium && (
        <Text style={styles.hint}>
          ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã«å…¥ã‚‹ã¨ã€{Math.round(image.fileSizeOriginal / 1024 / 1024 * 10) / 10}MB ã®æœ€é«˜ç”»è³ªã§è¡¨ç¤ºãƒ»ä¿å­˜ã§ãã¾ã™
        </Text>
      )}
      {!isPremium && image.isPremiumAtUpload && (
        <Text style={styles.hint}>
          ğŸ’ ã“ã®å†™çœŸã¯æœ€é«˜ç”»è³ªã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã§è¡¨ç¤ºã§ãã¾ã™
        </Text>
      )}
    </View>
  );
}
```

---

## 7. ç”»åƒç·¨é›†æ©Ÿèƒ½ã®è¨­è¨ˆ

### 7.1 ç·¨é›†ãƒ•ãƒ­ãƒ¼

1. **ç·¨é›†ç”»é¢ã‚’é–‹ã**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç”»åƒã‚’é¸æŠã—ã€ç·¨é›†ç”»é¢ã‚’é–‹ã
2. **ã‚¹ã‚¿ãƒ³ãƒ—ãƒ»æ–‡å­—ã‚’è¿½åŠ **: Expoã®`expo-pixi`ã‚„`react-native-canvas`ã‚’ä½¿ç”¨
3. **ç·¨é›†å®Œäº†**: `view-shot`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ç·¨é›†å¾Œã®ç”»åƒã‚’WebPã¨ã—ã¦æ›¸ãå‡ºã—
4. **ä¿å­˜**: 
   - **ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç·¨é›†å¾Œã®ç”»åƒã®ã¿ä¿å­˜ï¼ˆç·¨é›†å‰ã¯å‰Šé™¤ï¼‰
   - **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç·¨é›†å‰ãƒ»ç·¨é›†å¾Œã®ä¸¡æ–¹ã‚’ä¿å­˜ã€ç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿å­˜

### 7.2 ç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜

ç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ã§ã€å¾Œã‹ã‚‰ç·¨é›†ã‚’ã‚„ã‚Šç›´ã—ãŸã‚Šã€ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å‹•ã‹ã—ãŸã‚Šã§ãã¾ã™ã€‚

```typescript
// ç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¾‹
{
  originalBeforeEditStorageId: "storage_xxx", // ç·¨é›†å‰ã®ã‚ªãƒªã‚¸ãƒŠãƒ«
  stamps: [
    {
      type: "crown",
      x: 100,
      y: 200,
      scale: 1.0,
      rotation: 0,
    },
  ],
  texts: [
    {
      content: "ãƒãƒãã‚“",
      x: 150,
      y: 250,
      fontSize: 24,
      color: "#FFFFFF",
      fontFamily: "Arial",
    },
  ],
}
```

---

## 8. ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

### 8.1 ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼

- è¡¨ç¤ºç”¨WebPã®ã¿ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ï¼ˆã‚¢ãƒ—ãƒªãƒ­ã‚´ï¼‰ã‚’è¿½åŠ 
- ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ä¸å¯

### 8.2 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼

- æœ€é«˜ç”»è³ªWebPï¼ˆã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ãªã—ï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- ç·¨é›†å‰ã®ã€Œç´ ã€ã®çŠ¶æ…‹ã®ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆ1ãƒ¶æœˆåˆ†ã‚’ã¾ã¨ã‚ã¦ä¿å­˜ãªã©ï¼‰

---

## 9. AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ

### 9.1 ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼

- AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯åˆ©ç”¨ä¸å¯ï¼ˆã¾ãŸã¯1æ—¥1å›ã®ã¿ï¼‰
- ä»£ã‚ã‚Šã«ã€ã‚³ãƒ©ãƒ ãƒ»è¨˜äº‹ã®é–²è¦§ã‚’æ¨å¥¨

### 9.2 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼

- AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’ç„¡åˆ¶é™ã«åˆ©ç”¨å¯èƒ½
- ãƒšãƒƒãƒˆã®éå»1é€±é–“ã®ãƒ­ã‚°ï¼ˆé£Ÿäº‹é‡ã€ä¾¿ã®æ§˜å­ãªã©ï¼‰ã‚’AIã«èª­ã¿è¾¼ã¾ã›ãŸä¸Šã§å›ç­”
- ã€Œã†ã¡ã®å­å°‚ç”¨ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã€åŒ–

### 9.3 ã‚³ã‚¹ãƒˆç®¡ç†

- ç°¡å˜ãªè³ªå•ã¯å®‰ä¾¡ãªãƒ¢ãƒ‡ãƒ«ï¼ˆClaude Haikuãªã©ï¼‰ã§å‡¦ç†
- è¤‡é›‘ãªè³ªå•ã¯é«˜ä¾¡ãªãƒ¢ãƒ‡ãƒ«ï¼ˆGPT-4oã€Claude Opusãªã©ï¼‰ã§å‡¦ç†
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆã§ã‚³ã‚¹ãƒˆã‚’æœ€é©åŒ–

---

## 10. åˆ¶é™ã®å‡ºã—æ–¹ï¼ˆUXè¨­è¨ˆï¼‰

### 10.1 ã€Œç¦æ­¢ã€ã§ã¯ãªãã€Œå¾Œå›ã—ã€

ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚‚ç”»åƒã¯ã‚¢ãƒƒãƒ—ã§ãã‚‹ãŒã€50æšã‚’è¶…ãˆã‚‹ã¨ï¼š
- ã€Œå¤ã„å†™çœŸã‹ã‚‰ã¼ã‹ã—ï¼ˆBlurï¼‰ãŒã‹ã‹ã‚Šã€ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã«ãªã‚‹ã¨å¾©å…ƒã§ãã‚‹ã€ã¨ã„ã†è¦‹ã›æ–¹
- ã€Œãƒ‡ãƒ¼ã‚¿ã¯æ¶ˆã—ã¦ã„ãªã„ï¼ˆæ¸©ã‹ã¿ï¼‰ã€ã¨ã€Œä»Šã™ãã¯è¦‹ã‚‰ã‚Œãªã„ï¼ˆåˆ¶é™ï¼‰ã€ã‚’ä¸¡ç«‹

### 10.2 ã€ŒAIã‹ã‚‰ã®æ‹›å¾…ã€

ãƒšãƒƒãƒˆã®ä½“èª¿è¨˜éŒ²ãŒ3æ—¥ç¶šã„ãŸã‚‰ã€AIã‹ã‚‰ï¼š
- ã€Œ3æ—¥é–“é ‘å¼µã‚Šã¾ã—ãŸã­ï¼ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãªã‚‰ã€ã“ã®è¨˜éŒ²ã‹ã‚‰ãƒ¬ã‚ªãã‚“ã®å¥åº·è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œã‚Œã¾ã™ã‚ˆã€ã¨ã€æ–‡è„ˆã«æ²¿ã£ãŸææ¡ˆã‚’å‡ºã™

### 10.3 è¦–è¦šçš„ãªæ¡ˆå†…

- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ©Ÿèƒ½ã®æ¨ªã«å°ã•ãªéµã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º
- ç”»åƒã‚’æ‹¡å¤§ã—ãŸéš›ã€ã€Œãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãªã‚‰ Ultra HD ã§è¡¨ç¤ºãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€ã¨ã„ã†æ¡ˆå†…ã‚’å‡ºã™
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç”»é¢ã§ã¯ã€å†™çœŸã®éš…ã«ã€ŒSDï¼ˆæ¨™æº–ç”»è³ªï¼‰ã€ã¨ã„ã†å°ã•ãªãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤º

---

## 11. ã‚³ã‚¹ãƒˆè©¦ç®— âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œ**

### 11.1 Cloudflare R2ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆ âœ… **2026å¹´æ›´æ–°**

**ã‚·ãƒŠãƒªã‚ª**: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆMAUï¼‰1,000äººã®å ´åˆ
- å…¨å“¡ãŒãƒªã‚µã‚¤ã‚ºæ¸ˆã¿ç”»åƒï¼ˆè¡¨ç¤ºç”¨500KB + æœ€é«˜ç”»è³ª2.5MBï¼‰ã‚’æœˆ30æšã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼: æœˆé–“3æœ¬ã®å‹•ç”»ï¼ˆå„15ç§’ã€720p/HEVCã€ç´„13MB/æœˆï¼‰
- ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼: æœˆé–“10æœ¬ã®å‹•ç”»ï¼ˆå„60ç§’ã€1080p/HEVCã€ç´„350MB/æœˆï¼‰

**æœˆé–“ã®æ–°è¦ãƒ‡ãƒ¼ã‚¿å¢—åˆ†**:
- ç”»åƒ: 1,000äºº Ã— 90MB = 90 GB / æœˆ
- å‹•ç”»ï¼ˆç„¡æ–™:ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  = 9:1ï¼‰: 900äºº Ã— 13MB + 100äºº Ã— 350MB = 46.7 GB / æœˆ
- **åˆè¨ˆ**: ç´„137 GB / æœˆ

**1å¹´å¾Œã®ç·ãƒ‡ãƒ¼ã‚¿é‡**: 137GB Ã— 12ãƒ¶æœˆ = 1,644 GBï¼ˆç´„1.6 TBï¼‰

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœˆé¡è²»ç”¨ï¼ˆ1å¹´å¾Œã€Cloudflare R2ï¼‰**:
- 10GBã¾ã§ç„¡æ–™ã€10GBè¶…ã¯$0.015/GB/æœˆ
- (1,644 GB - 10 GB) Ã— $0.015 = ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰

**å¸¯åŸŸå¹…ï¼ˆEgress Feeï¼‰**: **å®Œå…¨ã«ç„¡æ–™**ï¼ˆ$0ï¼‰âœ… **2026å¹´è¿½åŠ  - R2ã®æœ€å¤§ã®ãƒ¡ãƒªãƒƒãƒˆ**

### 11.2 Convex File Storageã¨ã®æ¯”è¼ƒ âœ… **2026å¹´è¿½åŠ **

**Convex File Storageã®å ´åˆ**ï¼ˆå‚è€ƒï¼‰:
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 1GBã¾ã§ç„¡æ–™ã€1GBè¶…ã¯$0.03/GB/æœˆ
- å¸¯åŸŸå¹…: 10GB/æœˆã¾ã§ç„¡æ–™ã€10GBè¶…ã¯$0.30/GB
- **1å¹´å¾Œã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è²»ç”¨**: (1,644 GB - 1 GB) Ã— $0.03 = ç´„$49.3/æœˆï¼ˆç´„7,395å††/æœˆï¼‰
- **å¸¯åŸŸå¹…è²»ç”¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‹•ç”»ã‚’å†ç”Ÿã™ã‚‹ãŸã³ã«ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿï¼ˆãƒã‚ºã£ãŸéš›ã«ç ´ç”£ãƒªã‚¹ã‚¯ï¼‰

**Cloudflare R2ã®å ´åˆ**:
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰
- å¸¯åŸŸå¹…: **å®Œå…¨ã«ç„¡æ–™**ï¼ˆ$0ï¼‰
- **ç·ã‚³ã‚¹ãƒˆ**: ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰

**å‰Šæ¸›åŠ¹æœ**: ç´„50%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸› + å¸¯åŸŸå¹…ã‚³ã‚¹ãƒˆã®å®Œå…¨å‰Šæ¸› âœ… **2026å¹´è¿½åŠ **

### 11.3 ç„¡æ–™æ ã§ã®åˆ¶é™è¨­è¨ˆ âœ… **2026å¹´è¿½åŠ **

**Cloudflare R2ã®ç„¡æ–™æ ï¼ˆ10GBï¼‰ã§è€ãˆã‚‰ã‚Œã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**:
- ç”»åƒã®ã¿ï¼ˆè¡¨ç¤ºç”¨ï¼‰: ç´„660,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰
- ç”»åƒã®ã¿ï¼ˆæœ€é«˜ç”»è³ªã‚‚ä¿å­˜ï¼‰: ç´„130,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰
- å‹•ç”»ã®ã¿ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ï¼‰: ç´„770ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰
- æ··åˆï¼ˆç”»åƒ + å‹•ç”»ã€ç„¡æ–™:ãƒ—ãƒ¬ãƒŸã‚¢ãƒ  = 9:1ï¼‰: ç´„250ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ1ãƒ¶æœˆåˆ†ï¼‰

**ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®åˆ¶é™**:
- ç”»åƒ: ç´¯è¨ˆ50æšã¾ã§ï¼ˆç´„25MBï¼‰
- å‹•ç”»: 1æœ¬ã‚ãŸã‚Šæœ€å¤§15ç§’ã€1ãƒšãƒƒãƒˆã«ã¤ãæœˆé–“3æœ¬ã¾ã§ã€720p/HEVCï¼ˆç´„13MB/æœˆï¼‰

**ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®åˆ¶é™**:
- ç”»åƒ: ç„¡åˆ¶é™
- å‹•ç”»: 1æœ¬ã‚ãŸã‚Šæœ€å¤§60ç§’ã€ç„¡åˆ¶é™ã€1080p/HEVCï¼ˆç´„350MB/æœˆï¼‰

**ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœˆé¡è²»ç”¨ï¼ˆ1å¹´å¾Œã€Cloudflare R2ï¼‰**:
- 10GBã¾ã§ç„¡æ–™ã€10GBè¶…ã¯$0.015/GB/æœˆ
- (1,644 GB - 10 GB) Ã— $0.015 = ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰

**å¸¯åŸŸå¹…ï¼ˆEgress Feeï¼‰**: **å®Œå…¨ã«ç„¡æ–™**ï¼ˆ$0ï¼‰âœ… **2026å¹´è¿½åŠ  - R2ã®æœ€å¤§ã®ãƒ¡ãƒªãƒƒãƒˆ**

### 11.2 Convex File Storageã¨ã®æ¯”è¼ƒ âœ… **2026å¹´è¿½åŠ **

**Convex File Storageã®å ´åˆ**ï¼ˆå‚è€ƒï¼‰:
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: 1GBã¾ã§ç„¡æ–™ã€1GBè¶…ã¯$0.03/GB/æœˆ
- å¸¯åŸŸå¹…: 10GB/æœˆã¾ã§ç„¡æ–™ã€10GBè¶…ã¯$0.30/GB
- **1å¹´å¾Œã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è²»ç”¨**: (1,644 GB - 1 GB) Ã— $0.03 = ç´„$49.3/æœˆï¼ˆç´„7,395å††/æœˆï¼‰
- **å¸¯åŸŸå¹…è²»ç”¨**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‹•ç”»ã‚’å†ç”Ÿã™ã‚‹ãŸã³ã«ã‚³ã‚¹ãƒˆãŒç™ºç”Ÿï¼ˆãƒã‚ºã£ãŸéš›ã«ç ´ç”£ãƒªã‚¹ã‚¯ï¼‰

**Cloudflare R2ã®å ´åˆ**:
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸: ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰
- å¸¯åŸŸå¹…: **å®Œå…¨ã«ç„¡æ–™**ï¼ˆ$0ï¼‰
- **ç·ã‚³ã‚¹ãƒˆ**: ç´„$24.5/æœˆï¼ˆç´„3,675å††/æœˆï¼‰

**å‰Šæ¸›åŠ¹æœ**: ç´„50%ã®ã‚³ã‚¹ãƒˆå‰Šæ¸› + å¸¯åŸŸå¹…ã‚³ã‚¹ãƒˆã®å®Œå…¨å‰Šæ¸› âœ… **2026å¹´è¿½åŠ **

### 11.3 åç›ŠåŒ–ã®ç›®å®‰ âœ… **2026å¹´æ›´æ–°**

1,000äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã†ã¡ã€3ã€œ5%ï¼ˆ30ã€œ50äººï¼‰ãŒæœˆé¡500å††ã®ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ—ãƒ©ãƒ³ã«å…¥ã‚Œã°ï¼š
- æœˆé¡åç›Š: 30ã€œ50äºº Ã— 500å†† = 15,000å†† ã€œ 25,000å††
- ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆï¼ˆCloudflare R2ï¼‰: ç´„3,675å††/æœˆï¼ˆ1å¹´å¾Œï¼‰

**çµè«–**: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ç‡ã‚’3%ä»¥ä¸Šã«ç¶­æŒã§ãã‚Œã°ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆã‚’å›åå¯èƒ½ âœ… **2026å¹´æ›´æ–° - R2ç§»è¡Œã«ã‚ˆã‚Šã‚³ã‚¹ãƒˆãŒå¤§å¹…ã«å‰Šæ¸›**

---

## 12. å®Ÿè£…ã®å„ªå…ˆé †ä½ âœ… **2026å¹´æ›´æ–° - Cloudflare R2ç§»è¡Œãƒ»å‹•ç”»å¯¾å¿œ**

### Phase 1ï¼ˆå¿…é ˆï¼‰

1. **Cloudflare R2ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—** âœ… **2026å¹´è¿½åŠ **
   - R2ãƒã‚±ãƒƒãƒˆã®ä½œæˆï¼ˆTerraformï¼‰
   - CORSè¨­å®š
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®è¨­å®š
   - R2 API Tokenã®ç™ºè¡Œ
   - Convexç’°å¢ƒå¤‰æ•°ã®è¨­å®š

2. **ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼ˆR2çµŒç”±ï¼‰** âœ… **2026å¹´æ›´æ–°**
   - Expoã§ã®ç”»åƒå‡¦ç†ï¼ˆè¡¨ç¤ºç”¨ãƒ»æœ€é«˜ç”»è³ªã®2ç¨®é¡ã€WebPå¤‰æ›ï¼‰
   - Presigned URLã®ç™ºè¡Œï¼ˆConvex Actionï¼‰
   - R2ã¸ã®ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
   - `images`ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆï¼ˆR2é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ï¼‰

3. **ç”»åƒè¡¨ç¤ºæ©Ÿèƒ½ï¼ˆR2 URLä½¿ç”¨ï¼‰** âœ… **2026å¹´æ›´æ–°**
   - R2 URLã‚’ä½¿ç”¨ã—ãŸç”»åƒè¡¨ç¤ºï¼ˆCloudflare CDNçµŒç”±ï¼‰
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ åˆ¤å®šã«å¿œã˜ãŸç”»åƒURLã®åˆ‡ã‚Šæ›¿ãˆ
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ æ¡ˆå†…ã®è¡¨ç¤º

4. **ç”»åƒæšæ•°åˆ¶é™**
   - ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç´¯è¨ˆ50æšåˆ¶é™
   - åˆ¶é™åˆ°é”æ™‚ã®æ¡ˆå†…

### Phase 2ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

5. **å‹•ç”»ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½** âœ… **2026å¹´è¿½åŠ **
   - å‹•ç”»ã®è‡ªå‹•åœ§ç¸®ï¼ˆHEVCå½¢å¼ã€720p/1080pï¼‰
   - ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
   - Presigned URLã®ç™ºè¡Œï¼ˆConvex Actionï¼‰
   - R2ã¸ã®ç›´æ¥ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
   - `images`ãƒ†ãƒ¼ãƒ–ãƒ«ã«å‹•ç”»é–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 

6. **å‹•ç”»å†ç”Ÿæ©Ÿèƒ½** âœ… **2026å¹´è¿½åŠ **
   - R2 URLã‚’ä½¿ç”¨ã—ãŸå‹•ç”»å†ç”Ÿï¼ˆCloudflare CDNçµŒç”±ï¼‰
   - å†ç”Ÿã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆå†ç”Ÿãƒ»ä¸€æ™‚åœæ­¢ãƒ»ã‚·ãƒ¼ã‚¯ãƒãƒ¼ï¼‰
   - å…¨ç”»é¢å†ç”Ÿ
   - ã‚µãƒ ãƒã‚¤ãƒ«è¡¨ç¤º

7. **å‹•ç”»ã®åˆ¶é™ã¨æ¡ˆå†…** âœ… **2026å¹´è¿½åŠ **
   - ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1æœ¬ã‚ãŸã‚Šæœ€å¤§15ç§’ã€1ãƒšãƒƒãƒˆã«ã¤ãæœˆé–“3æœ¬ã¾ã§
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼: 1æœ¬ã‚ãŸã‚Šæœ€å¤§60ç§’ã€ç„¡åˆ¶é™
   - åˆ¶é™åˆ°é”æ™‚ã®æ¡ˆå†…

8. **ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½**
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã§æœ€é«˜ç”»è³ªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒãƒ¼ã‚¯ã®è¿½åŠ ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

9. **å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½** âœ… **2026å¹´è¿½åŠ **
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã§å‹•ç”»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆHEVCå½¢å¼ï¼‰

10. **ç”»åƒç·¨é›†æ©Ÿèƒ½ï¼ˆåŸºæœ¬ï¼‰**
    - ã‚¹ã‚¿ãƒ³ãƒ—ãƒ»æ–‡å­—å…¥ã‚Œæ©Ÿèƒ½
    - ç·¨é›†å¾Œã®ç”»åƒä¿å­˜

### Phase 3ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰

6. **ç”»åƒç·¨é›†æ©Ÿèƒ½ï¼ˆé«˜åº¦ï¼‰**
   - éç ´å£Šç·¨é›†ï¼ˆç·¨é›†ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼‰
   - ç·¨é›†ã®ã‚„ã‚Šç›´ã—æ©Ÿèƒ½

7. **ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½**
   - ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šã§1ãƒ¶æœˆåˆ†ã‚’ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

---

## 13. AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®è¨­è¨ˆ

### 13.1 ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼

- AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯åˆ©ç”¨ä¸å¯ï¼ˆã¾ãŸã¯1æ—¥1å›ã®ã¿ï¼‰
- ä»£ã‚ã‚Šã«ã€ã‚³ãƒ©ãƒ ãƒ»è¨˜äº‹ã®é–²è¦§ã‚’æ¨å¥¨

### 13.2 ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ¦ãƒ¼ã‚¶ãƒ¼

- AIãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’ç„¡åˆ¶é™ã«åˆ©ç”¨å¯èƒ½
- ãƒšãƒƒãƒˆã®éå»1é€±é–“ã®ãƒ­ã‚°ï¼ˆé£Ÿäº‹é‡ã€ä¾¿ã®æ§˜å­ãªã©ï¼‰ã‚’AIã«èª­ã¿è¾¼ã¾ã›ãŸä¸Šã§å›ç­”
- ã€Œã†ã¡ã®å­å°‚ç”¨ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã€åŒ–

### 13.3 ã‚³ã‚¹ãƒˆç®¡ç†

- ç°¡å˜ãªè³ªå•ã¯å®‰ä¾¡ãªãƒ¢ãƒ‡ãƒ«ï¼ˆClaude Haikuãªã©ï¼‰ã§å‡¦ç†
- è¤‡é›‘ãªè³ªå•ã¯é«˜ä¾¡ãªãƒ¢ãƒ‡ãƒ«ï¼ˆGPT-4oã€Claude Opusãªã©ï¼‰ã§å‡¦ç†
- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆã§ã‚³ã‚¹ãƒˆã‚’æœ€é©åŒ–

### 13.4 å®Ÿè£…æ–¹é‡

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆConvex Actionï¼‰**:
```typescript
import { assertPremium } from "./lib/permissions";

export const chat = action({
  args: {
    petId: v.id("pets"),
    threadId: v.id("chat_threads"),
    message: v.string(),
  },
  handler: async (ctx, args) => {
    // ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ä¼šå“¡ã§ã‚ã‚‹ã“ã¨ã‚’è¦æ±‚
    await assertPremium(ctx);
    
    // AIç›¸è«‡ã®å‡¦ç†
    // ...
  },
});
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰**:
```typescript
import { PremiumGuard } from "@repo/ui";

export default function AIChatScreen() {
  return (
    <PremiumGuard>
      <AIChatContent />
    </PremiumGuard>
  );
}
```

---

## 14. å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- `CONVEX_SCHEMA.md`: ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆ`images`ãƒ†ãƒ¼ãƒ–ãƒ«ã€`users.subscription`ï¼‰
- `USER_STORIES.md`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼ˆç”»åƒé–¢é€£: US-051ã€œUS-054ã€AIç›¸è«‡: US-020ã€œUS-025ï¼‰
- `PREMIUM_FEATURES.md`: ãƒ—ãƒ¬ãƒŸã‚¢ãƒ é™å®šæ©Ÿèƒ½ãƒªã‚¹ãƒˆ
- `packages/backend/convex/lib/permissions.ts`: æ¨©é™ç®¡ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- `packages/backend/convex/lib/imageLimits.ts`: ç”»åƒåˆ¶é™ç®¡ç†ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
