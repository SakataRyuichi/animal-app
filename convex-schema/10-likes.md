# 10. likesï¼ˆã„ã„ã­ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰

**ðŸ“š ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: [CONVEX_SCHEMA_INDEX.md](../CONVEX_SCHEMA_INDEX.md)

### 10. likesï¼ˆã„ã„ã­ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰âœ… **2026å¹´æ›´æ–° - å¤šæ©Ÿèƒ½ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³**

**ç›®çš„**: Phase 3ã§å®Ÿè£…ã€‚æŠ•ç¨¿ã¸ã®ã„ã„ã­ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç®¡ç†

**ä¸»è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**:
- `userId`: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼
- `activityId`: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚ŒãŸæŠ•ç¨¿ï¼ˆactivitiesï¼‰
- `reactionType`: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ï¼ˆreaction_typesã®reactionIdã‚’å‚ç…§ï¼‰âœ… **2026å¹´è¿½åŠ **
  - `"heart"`: â¤ï¸ å¤§å¥½ã/å…±æ„Ÿ
  - `"sunflower"`: ðŸŒ» ç™’ã‚„ã•ã‚ŒãŸ
  - `"muscle"`: ðŸ’ª å¿œæ´ã—ã¦ã‚‹/é ‘å¼µã‚Œ
  - `"star"`: ðŸŒŸ ã‚­ãƒ©ã‚­ãƒ©ã—ãŸçž¬é–“
  - `"rainbow"`: ðŸŒˆ è™¹ã®æ©‹ã®ã‚ã¡ã‚‰å´ã¸ã®ç¥ˆã‚Š/æƒ³ã„
- `createdAt`: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ—¥æ™‚

**å°‚é–€å®¶ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**:
- `users`ãƒ†ãƒ¼ãƒ–ãƒ«ã®`isExpert`ãƒ•ãƒ©ã‚°ãŒ`true`ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸå ´åˆã€æŠ•ç¨¿ã«ã€Œç£åŒ»å¸«ãŒæŽ¨å¥¨ã€ãªã©ã®ç‰¹åˆ¥ãªãƒãƒƒã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- å°‚é–€å®¶ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯é€šå¸¸ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯åŒºåˆ¥ã•ã‚Œã€ãŠã™ã™ã‚ãƒ•ã‚£ãƒ¼ãƒ‰ã§å„ªå…ˆçš„ã«è¡¨ç¤ºã•ã‚Œã‚‹

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `by_activity`: æŠ•ç¨¿ã”ã¨ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼‰
- `by_user_activity`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸã‹ã©ã†ã‹ã®ç¢ºèªï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
- `by_user`: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸæŠ•ç¨¿ä¸€è¦§
- `by_activity_reaction`: æŠ•ç¨¿ãƒ»ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã§ã®æ¤œç´¢ âœ… **2026å¹´è¿½åŠ **ï¼ˆãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—åˆ¥ã®é›†è¨ˆç”¨ï¼‰

**ä½¿ç”¨ä¾‹**:
```typescript
// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒãƒ¼ãƒˆï¼‰
await ctx.db.insert("likes", {
  userId: currentUserId,
  activityId: activityId,
  reactionType: "heart", // âœ… **2026å¹´è¿½åŠ **
  createdAt: Date.now(),
});

// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆè™¹ã®æ©‹ï¼‰
await ctx.db.insert("likes", {
  userId: currentUserId,
  activityId: activityId,
  reactionType: "rainbow", // âœ… **2026å¹´è¿½åŠ **
  createdAt: Date.now(),
});

// ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è§£é™¤
await ctx.db.delete(likeId);

// æŠ•ç¨¿ã”ã¨ã®ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é›†è¨ˆ
const reactions = await ctx.db
  .query("likes")
  .withIndex("by_activity_reaction", (q) => 
    q.eq("activityId", activityId)
  )
  .collect();

const reactionCounts = reactions.reduce((acc, reaction) => {
  acc[reaction.reactionType] = (acc[reaction.reactionType] || 0) + 1;
  return acc;
}, {} as Record<string, number>);
```

---
