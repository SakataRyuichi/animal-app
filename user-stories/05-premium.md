# Epic 5: プレミアム機能

**📚 インデックス**: [USER_STORIES_INDEX.md](../USER_STORIES_INDEX.md)

## プレミアム機能

#### US-019: プレミアム会員登録
**画面パス**: `app/settings/premium.tsx`
**As a** ユーザー  
**I want to** プレミアム会員になる  
**So that** 高度な機能を利用できる

**受け入れ基準**:
- RevenueCatでサブスクリプションを購入できる
- 購入後、`subscription.tier`が`"premium"`になり、`subscription.status`が`"active"`になる
- プレミアム機能が有効になる
- サブスクリプションの期限（`endsAt`）が設定される

**体験価値**:
- **高度な機能**: 詳細な統計情報や家族・チーム管理など、より充実した機能を利用できる
- **継続性**: サブスクリプションにより、継続的に価値ある機能を受けられる

**優先度**: 中

---

---

#### US-019-1: プレミアム限定機能へのアクセス制御
**画面パス**: 各プレミアム限定画面（コンポーネント: `PremiumGuard`）
**As a** 無料ユーザー  
**I want to** プレミアム限定機能にアクセスしようとする  
**So that** プレミアム機能の価値を理解し、アップグレードを検討できる

**受け入れ基準**:
- プレミアム限定機能（詳細統計、家族・チーム管理など）にアクセスしようとすると、バックエンド（Convex）でエラーが返される
- エラーコード`PREMIUM_REQUIRED`が返される
- フロントエンドでエラーをキャッチし、アップグレード案内を表示する
- プレミアム限定機能の横にロックアイコンが表示される

**体験価値**:
- **明確な価値提示**: プレミアム機能の価値を理解できる
- **スムーズな導線**: アップグレードへの導線が自然に表示される

**優先度**: 高

---

---

#### US-019-2: プレミアム限定画面へのアクセス制御
**画面パス**: 各プレミアム限定画面（コンポーネント: `PremiumGuard`）
**As a** 無料ユーザー  
**I want to** プレミアム限定画面（詳細統計画面など）にアクセスしようとする  
**So that** プレミアム機能の価値を視覚的に理解し、アップグレードを検討できる

**受け入れ基準**:
- プレミアム限定画面にアクセスしようとすると、`PremiumGuard`コンポーネントが動作する
- プレミアムでない場合、アップグレード案内が表示される
- ハーフモーダル（Sheet）で「家族みんなで記録を共有するにはプレミアムへ」という温かみのあるコピーとイラストが表示される
- プレミアム限定の統計画面などは、ぼかし（Blur）をかけた背景に「データが集計されています。プレミアムで詳細を見る」というテキストが表示される

**体験価値**:
- **視覚的な価値提示**: プレミアム機能の価値を視覚的に理解できる
- **温かみのあるUX**: 強制的ではなく、優しい案内でアップグレードを促す

**使用シーン**:
- 詳細統計画面にアクセスしようとした時
- 家族・チーム管理機能にアクセスしようとした時
- 高度なAI相談機能にアクセスしようとした時

**優先度**: 高

---

---

#### US-019-3: アップグレード案内の表示
**画面パス**: 各プレミアム限定画面（コンポーネント: `UpgradePrompt`）
**As a** 無料ユーザー  
**I want to** プレミアム機能について知る  
**So that** プレミアム会員になる価値を理解し、アップグレードを検討できる

**受け入れ基準**:
- プレミアム限定機能の横に小さな鍵アイコンが表示される
- 鍵アイコンをタップすると、「プレミアムへの招待モーダル」が開く
- モーダルには、プレミアム機能のメリットが分かりやすく表示される
- 「家族みんなで記録を共有」「詳細な統計情報」「高度なAI相談」などの機能が紹介される
- RevenueCatのサブスクリプション購入画面への導線が表示される
- 温かみのある色とイラストが使用される

**体験価値**:
- **価値の理解**: プレミアム機能の価値を理解できる
- **スムーズな導線**: アップグレードへの導線が自然に表示される

**使用シーン**:
- プレミアム限定機能を発見した時
- 詳細統計画面にアクセスしようとした時
- 設定画面からプレミアム機能について知りたい時

**優先度**: 高

---

---

#### US-019-4: 猶予期間（Grace Period）の管理
**画面パス**: `app/settings/premium.tsx`（バックエンド処理）
**As a** プレミアム会員  
**I want to** 支払いが失敗しても一定期間はプレミアム機能を利用できる  
**So that** 支払い情報を更新する時間的余裕ができ、突然機能が制限される不安を感じない

**受け入れ基準**:
- 支払いが失敗した場合、`subscription.status`が`"past_due"`になる
- `gracePeriodEndsAt`が設定され、デフォルトで7日間の猶予期間が与えられる
- 猶予期間中は、プレミアム機能を引き続き利用できる
- 猶予期間中は、「お支払い情報の更新が必要です」という優しい通知が表示される
- 猶予期間を過ぎると、プレミアム機能が制限される

**体験価値**:
- **安心感**: 支払い情報を更新する時間的余裕ができ、突然機能が制限される不安を感じない
- **継続性**: 猶予期間中もプレミアム機能を利用できるため、サービスを継続しやすい

**使用シーン**:
- クレジットカードの有効期限が切れた時
- 支払いが失敗した時

**優先度**: 中

---

### ユーザーフィードバック機能（Phase 2）✅ **温かみのある離脱対応**

---

#### US-055: プレミアム解除理由の収集
**画面パス**: `app/settings/premium.tsx`
**As a** プレミアム会員  
**I want to** プレミアムを解除する理由を選択できる  
**So that** サービス改善に貢献できる

**受け入れ基準**:
- プレミアム解除時に、理由を選択できる画面が表示される
- 選択肢:
  1. 今は必要な機能を使い切った
  2. 家計を見直したい
  3. 無料版の機能で満足している
  4. 操作が難しく感じた
- 自由記述欄も用意される（オプション）
- 理由を選択せずにスキップできる

**体験価値**:
- **温かみ**: 離脱時も温かく対応される
- **貢献感**: サービス改善に貢献できる

**優先度**: 低

---

---

#### US-056: 退会理由の収集
**画面パス**: `app/settings/account-deletion.tsx`
**As a** ユーザー  
**I want to** アカウント削除の理由を選択できる  
**So that** サービス改善に貢献できる

**受け入れ基準**:
- アカウント削除時に、理由を選択できる画面が表示される
- 選択肢:
  1. 今は少しアプリ（記録）から離れたい ✅ **コンテキストを汲み取った「お休み」の提案**
  2. 生活スタイルが変わって記録が難しくなった
  3. 他の管理方法（ノートやSNSなど）に変える
  4. アプリの通知や操作が自分に合わなかった
  5. 使い方がわからなかった
- **重要**: 「お別れ」という項目は含めない（常に前向きに成長や日々の記録を祝うアプリのスタンス）
- 「今は少しアプリ（記録）から離れたい」を選択した際、AI（Claude）が**「これまで〇〇ちゃんと一緒に歩んできた記録は、私たちが大切に保管しておきます。心が落ち着いたとき、いつでもまた会いに来てくださいね」**というメッセージを出す
- 自由記述欄も用意される（オプション）
- 理由を選択せずにスキップできる

**体験価値**:
- **温かみ**: 離脱時も温かく対応される
- **貢献感**: サービス改善に貢献できる

**優先度**: 低

---

### メモリアル機能（Phase 2）✅ **非常にセンシティブな項目 - 思い出の保護**

---

#### US-067: 追悼（メモリアル）プランの導入 ✅ **2026年最終設計検証で追加**
**画面パス**: `app/settings/memorial.tsx`, `app/settings/premium.tsx`
**As a** ペットが虹の橋を渡った飼い主  
**I want to** 新しい記録がなくなった後も、思い出（高画質画像）を見るために課金を続けなくても良い  
**So that** 経済的な負担を感じることなく、ペットとの思い出を大切にできる

**受け入れ基準**:
- ペットが虹の橋を渡り、メモリアルモードに移行した際、「追悼（メモリアル）プラン」への移行を提案される
- メモリアルプランは月額無料または極安価で、データの保持と閲覧だけを許可する「読み取り専用」の状態
- プレミアム会員だった期間のデータは、退会後も一定期間（例：1年間）「最高画質」でエクスポート可能
- メモリアルプランでは、新しい記録の追加はできないが、これまでの記録と写真は最高画質で閲覧可能
- メモリアルプランから通常のプレミアムプランに戻ることも可能（新しいペットを追加する場合など）

**体験価値**:
- **経済的配慮**: 新しい記録がなくなった後も、経済的な負担を感じることなく思い出を大切にできる
- **思い出の保護**: プレミアム会員だった期間のデータは、退会後も一定期間最高画質でエクスポート可能

**使用シーン**:
- ペットが虹の橋を渡り、メモリアルモードに移行した時
- プレミアム会員だったが、新しい記録がなくなったため退会を検討している時

**優先度**: 中

---

---

