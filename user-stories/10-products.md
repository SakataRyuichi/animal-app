# Epic 10: 商品データベース

**📚 インデックス**: [USER_STORIES_INDEX.md](../USER_STORIES_INDEX.md)

## 商品データベース

#### US-044: 商品検索 ✅ **2026年更新 - 体験をよくする検索機能**
**画面パス**: `app/products/index.tsx`

**As a** ペットの餌や保険、ペットグッズを探している飼い主  
**I want to** 様々なカテゴリの商品を効率的に検索できる  
**So that** 自分のペットに最適な商品を素早く見つけられる

**受け入れ基準**:
- **統合検索**: 餌、保険、ペットグッズなど多岐にわたるカテゴリを横断的に検索できる
- **検索体験の向上**:
  - 検索候補の自動補完（入力中に候補が表示される）
  - 検索履歴の表示（過去に検索した商品を素早く再検索）
  - 人気検索キーワードの表示（他のユーザーがよく検索しているキーワード）
  - 検索結果の並び替え（評価順、レビュー数順、新着順）
- **フィルター機能**:
  - カテゴリでフィルター（餌、保険、おもちゃ、ケージなど）
  - ブランドでフィルター
  - 製造会社でフィルター（餌の場合）
  - 種別でフィルター（自分のペットの種別に合った商品を優先表示）
  - 評価でフィルター（4つ星以上など）
- **検索結果の表示**:
  - 商品名、ブランド、製造会社、画像、平均評価、レビュー数が表示される
  - アソシエイトAPI（Amazon/楽天）で取得したデータがある場合は「公式情報あり」バッジを表示
  - データがない場合は「情報募集中」と表示し、ユーザーが情報を追加できる導線を提供
- **検索結果が0件の場合**:
  - 「商品が見つかりませんでした」と表示
  - 「新規商品を登録する」ボタンを表示
  - 類似商品の提案（検索キーワードに近い商品を表示）

**体験価値**:
- **効率性**: 統合検索により、複数のカテゴリを横断的に検索でき、時間を節約できる
- **発見性**: 検索候補や人気キーワードにより、自分が探していなかった商品も発見できる
- **信頼性**: アソシエイトAPI（Amazon/楽天）で取得した公式情報がある商品は、信頼性が高いことが一目で分かる
- **包括性**: 餌、保険、ペットグッズなど、ペットに関連するすべての商品を一箇所で検索できる

**使用シーン**:
- 新しいフードを探している時、商品名やブランド名で検索
- ペット保険を比較したい時、カテゴリで「保険」をフィルター
- おもちゃを探している時、種別でフィルターして自分のペットに合った商品を探す
- 検索履歴から、以前検索した商品を素早く再検索

**優先度**: 最高（Phase 3の核心機能）

---

---

#### US-045: 商品詳細表示 ✅ **2026年更新 - アソシエイトAPI情報の表示**
**画面パス**: `app/products/[id].tsx`

**As a** 商品の詳細情報を確認したい飼い主  
**I want to** 商品の詳細情報（製造会社、説明、成分表など）を確認できる  
**So that** 商品の品質や安全性を判断できる

**受け入れ基準**:
- **基本情報**:
  - 商品名、ブランド、製造会社、カテゴリが表示される
  - 商品画像が表示される
  - 平均評価、レビュー数が表示される
  - アフィリエイトリンクが表示される（Amazon/楽天のアソシエイトAPIから自動取得）
- **アソシエイトAPI（Amazon/楽天）で取得した情報**（餌の場合）:
  - **商品説明**: APIで取得した説明が表示される
  - **成分表（原材料）**: 原材料が表示される（データがない場合は「情報募集中」と表示）
  - **栄養成分**: タンパク質、脂質、繊維、水分、灰分、カルシウム、リンなどが表示される（データがない場合は「情報募集中」と表示）
  - **対象種別・ライフステージ**: 対象となる種別やライフステージが表示される（例: 「成犬用」「子猫用」）
  - **パッケージサイズ**: パッケージサイズが表示される（例: 「2kg」「5kg」）
  - **カロリー**: 100gあたりのカロリーが表示される
- **データの出所表示**:
  - アソシエイトAPIで取得したデータがある場合は「公式情報（Amazon）」または「公式情報（楽天）」バッジと商品ページへのリンクを表示
  - データがない場合は「情報募集中」と表示し、ユーザーが情報を追加できる導線を提供
- **レビュー情報**:
  - レビュー一覧へのリンクが表示される
  - 種別ごとの評価が表示される（例: 「犬: 4.5/5」「猫: 4.2/5」）

**体験価値**:
- **信頼性**: アソシエイトAPI（Amazon/楽天）で取得した公式情報により、商品の品質や安全性を判断できる
- **透明性**: データの出所（Amazon/楽天）が明確に表示されるため、情報の信頼性が分かる
- **包括性**: 成分表や栄養成分など、詳細な情報が一箇所で確認できる
- **協力性**: データがない場合、ユーザーが情報を追加できることで、コミュニティ全体の価値が向上する

**使用シーン**:
- 新しいフードを検討している時、成分表や栄養成分を確認
- ペットの健康状態に合わせて、適切な栄養成分のフードを選ぶ
- 製造会社の情報を確認して、信頼できるメーカーの商品を選ぶ
- データがない商品の場合、自分が知っている情報を追加してコミュニティに貢献

**優先度**: 最高（Phase 3の核心機能）

---

---

#### US-046: 商品登録（ユーザー投稿） ✅ **2026年更新 - アソシエイトAPI連携**
**画面パス**: `app/products/register.tsx`

**As a** 新しい商品を登録したい飼い主  
**I want to** 商品を登録し、可能であればAmazon/楽天のアソシエイトAPIで公式情報を自動取得する  
**So that** 活動ログで使用でき、他のユーザーにも正確な情報を提供できる

**受け入れ基準**:
- **基本情報の入力**:
  - 商品名、カテゴリ、ブランドを入力できる
  - 製造会社を入力できる（餌の場合）
  - 商品画像をアップロードできる（APIで取得した画像を使用することも可能）
  - 商品説明を入力できる（オプション）
- **アソシエイトAPI連携**（Amazon/楽天）:
  - 商品名やブランド名を入力後、「公式情報を自動取得（Amazon/楽天）」ボタンを表示
  - APIソースを選択できる（Amazonまたは楽天）
  - ボタンをタップすると、バックエンドでアソシエイトAPIを実行
  - API実行中は「情報を取得中...」と表示
  - APIが成功した場合:
    - 製造会社、説明、成分表、栄養成分、商品画像、アフィリエイトリンクなどが自動で入力される
    - 「公式情報を取得しました（Amazon）」または「公式情報を取得しました（楽天）」と表示
    - 取得した情報を確認・編集できる
  - APIが失敗した場合:
    - 「公式情報の取得に失敗しました」と表示
    - エラーメッセージが表示される（例: 「APIキーが無効です」「商品が見つかりませんでした」）
    - 手動で情報を入力できる
  - APIでデータが見つからなかった場合:
    - 「商品が見つかりませんでした」と表示
    - 別のAPIソース（Amazon/楽天）で再試行できる
    - 手動で情報を入力できる
- **手動入力**:
  - APIで取得できない情報は、手動で入力できる
  - 成分表、栄養成分、対象種別、ライフステージなどを入力できる
  - データがない場合は、空欄のままでも登録可能
- **登録後の処理**:
  - 登録後、`isVerified: false`で保存される
  - `affiliateApiInfo`にAPI実行結果が記録される（APIソース、商品ID、実行日時、状態など）
  - 運営承認待ちの状態が表示される
  - APIで取得したデータがある場合は、承認が優先される

**体験価値**:
- **効率性**: アソシエイトAPIにより、手動で入力する手間が省ける
- **正確性**: Amazon/楽天の公式APIから情報を取得することで、正確な情報を提供できる
- **信頼性**: 公式APIから取得した情報は、信頼性が高い
- **柔軟性**: APIで取得できない情報は、手動で入力できる
- **協力性**: データがない場合でも登録でき、後から情報を追加できる

**使用シーン**:
- 新しいフードを登録する時、商品名を入力して「公式情報を自動取得（Amazon）」をタップ
- APIで情報が取得できた場合、確認して登録
- APIで情報が取得できなかった場合、別のAPIソース（楽天）で再試行
- APIで情報が取得できなかった場合、手動で情報を入力して登録
- データがない商品でも、基本的な情報だけを入力して登録

**優先度**: 高

---

**注意**: 商品承認機能（US-047）は管理画面側の機能です。詳細は`ADMIN_USER_STORIES.md`のADM-006を参照してください。

---

### レビュー機能

---

